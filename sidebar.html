<!DOCTYPE html>
<html>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="sidebar.css">

    <title>Test Sunburst</title>
<body>
	<div id="main">

		<div id="topbar" class="row">
			<div class="col-md-offset-2">
			<div class="col-md-10">
				<div class="row">
					<div class="col-md-2" style="background-color:#F9CE66;"></div>
					<div class="col-md-2" style="background-color:#D89F71;"></div>
					<div class="col-md-2" style="background-color:#826A84;"></div>
					<div class="col-md-2" style="background-color:#A86D6D;"></div>
					<div class="col-md-2" style="background-color:#8FB588;"></div>
					<div class="col-md-2" style="background-color:#455C7C;"></div>
				</div>
				<div class="row">
					<div class="col-md-2" style="">Chemistry</div>
					<div class="col-md-2" style="">Economics</div>
					<div class="col-md-2" style="">Literature</div>
					<div class="col-md-2" style="">Medicine</div>
					<div class="col-md-2" style="">Peace</div>
					<div class="col-md-2" style="">Physics</div>
				</div>
			</div>
		</div>


      <div id="sequence"></div>

      </div>

      <div id="chart">
        <div id="explanation" style="visibility: hidden;">
          <span id="percentage"></span><br/>
          of visits begin with this sequence of pages
        </div>

		<div id="sidebar" style="display:inline-block;">
			<div>
		        <form ng-submit="" class="form-inline">
					<div class="input-group input-block-level" style="width:100%;">
						<label>Select country:</label>
						<select class="form-control">
						  <option value="sverige">Sverige</option>
						  <option value="kina">Kina</option>
						  <option value="frankrike">Frankrike</option>
						  <option value="mexico">Mexico</option>
						</select>
					</div>
				</form>
			</div>


	        <div id="info">

	      		<h1 id="name"></h1>
	      		<table id="laureateInfo">
	      			<tr>
		      			<td>Country:</td> <td id="country"></td>
		      		</tr>
		      		<tr>
		      			<td>Category:</td> <td id="category"></td>
		      		</tr>
		      		<tr>
		      			<td>Year:</td> <td id="year"></td>
		      		</tr>
	      		</table>
	      		<table id="countryInfo">
	      			<tr>
		      			<td>Number of lauretes:</td> <td id="num"></td>
		      		</tr>
	      		</table>
	      	</div>

	        <div id="legend">
	    		
				  <p id="Chemistry">
				   <span class="glyphicon glyphicon-stop" style="color:#F9CE66;"></span>
				   Chemistry
				  <p>
				   	<p id="Economics">
				   	<span class="glyphicon glyphicon-stop" style="color:#D89F71;"></span>
				   Economics
				  </p>
				  <p id="Literature">
				   <span class="glyphicon glyphicon-stop" style="color:#826A84;"></span>
				   Literature
				  </p>
				  <p id="Medicine">
				   <span class="glyphicon glyphicon-stop" style="color:#A86D6D;"></span>
				   Medicine
				  </p>
					<p id="Peace">
				   <span class="glyphicon glyphicon-stop" style="color:#8FB588;"></span>
				   Peace
				  </p>
					<p id="Physics">
				   <span class="glyphicon glyphicon-stop" style="color:#455C7C;"></span>
				   Physics 
				  </p>
	      	</div>
	    </div>

    </div>
    </div>
</body>
<style>
	body {
		background: #eee;
	}

</style>

<script src="d3.v3.js"></script>
<script>
	//sets up the intial variables
	var width = 960,
	    height = 700,
	    radius = Math.min(width, height) / 2,
	    x = d3.scale.linear()
	    	.range([0, 2 * Math.PI]),
	    y = d3.scale.sqrt()
	    	.range([0, radius]);

	//predefined colors for continents
	var colors = {
		"Australia": "#29374a" , //Purple
		"North America": "#4e3f4f", //Blue
		"South America": "#644141", //Cyan
		"Asia": "#815f43", //Teal
		"Africa": "#957b3d", //Amber
		"Europe": "#556c51" //Deep Orange
	};

	//below color variables returns a color in a predefined domain for countries belonging to the different continents
	var AustraliaColor = d3.scale.linear()
			.domain([1, 9])
			.range(["#a2adbd", "#29374a"])
			//.range(["#E1BEE7", "#9C27B0", "#6A1B9A"]) // 100, 500, 800
			.interpolate(d3.interpolate);
	var NAmericaColor = d3.scale.linear()
			.domain([1, 9])
			.range(["#c0b4c1", "#4e3f4f"])
			//.range(["#BBDEFB", "#2196F3", "#1565C0"])
			.interpolate(d3.interpolate);
	var SAmericaColor = d3.scale.linear()
			.domain([1, 9])
			.range(["#d3b6b6", "#644141"])
			//.range(["#B2EBF2", "#00BCD4", "#00838F"])
			.interpolate(d3.interpolate);
	var AsiaColor = d3.scale.linear()
			.domain([1, 9])
			.range(["#e7c5a9", "#815f43"])
			//.range(["#B2DFDB", "#009688", "#00695C"])
			.interpolate(d3.interpolate);
	var AfricaColor = d3.scale.linear()
			.domain([1, 9])
			.range(["#fce6b2", "#957b3d"])
			//.range(["#FFECB3", "#FFC107", "#FF8F00"])
			.interpolate(d3.interpolate);
	var EuropeColor = d3.scale.linear()
			.domain([1, 9])
			.range(["#c7dac3", "#556c51"])
			//.range(["#FFCCBC", "#FF5722", "#D84315"])
			.interpolate(d3.interpolate);

	//perhaps unnecessary atm, but returns predefined colors for the different continents
	function colorPicker (country) {
		return colors[String(country)];
	}

	//the predefined colors of the different prize categories
	var categoryColors = {
	  "Physics":  "#455C7C",//"#B2DFDB", //"#A5D6A7", //Green
	  "Literature": "#826A84",//"#26A69A", //"#E6EE9C", //Lime
	  "Medicine": "#A86D6D",//"#004D40", //"#B3E5FC", //Light Blue
	  "Economics": "#D89F71",//"#CDDC39", //"#B0BEC5", //Blue Grey
	  "Chemistry": "#F9CE66",//"#81C784", //"#F06292", //Pink
	  "Peace": "#8FB588"//"#AFB42B"//"#E57373" //Red
	};
	
	//sets up the svg canvas where sunburst is placed
	var vis = d3.select("#chart").append("svg")
	    .attr("width", width)
	    .attr("height", height)
	    .append("g")
	    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
	
	var partition = d3.layout.partition()
	    .sort(null)
	    .value(function(d) { return 1; });

	//determines the angles and radius of the levels and pieces
	var arc = d3.svg.arc()
		.startAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x))); })
		.endAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x + d.dx))); })
		.innerRadius(function(d) { return Math.max(0, y(d.y)); })
		.outerRadius(function(d) { return Math.max(0, y(d.y + d.dy)); });
	
	//global variables needed further down
	var node;
	var currentRoot;

	//loads json file & add attributes etc to the path (sunburst piece)
	d3.json("flare1.json", function(json) {
		var path = vis.datum(json).selectAll("path")
	    	.data(partition.nodes)
	     .enter().append("path")
	       	.attr("id", function(d, i) { return "path-" + i; })
	       	.attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
	       	.attr("d", arc)
	       	.style("stroke", "#fff")
	       	.style("fill", function(d) {
		    	if (d["category"]) {
		       		var category = d["category"];
		       		if (category === "Physics") {
		       			return categoryColors["Physics"];
		       		} else if (category === "Literature") {
		       			return categoryColors["Literature"];
		       		} else if (category === "Medicine") {
		       			return categoryColors["Medicine"];
		       		} else if (category === "Economics") {
		       			return categoryColors["Economics"];
		       		} else if (category === "Chemistry") {
		       			return categoryColors["Chemistry"];
		       		} else if (category === "Peace") {
		       			return categoryColors["Peace"];
		       		}
		    	} else {
		    		if(d["continent"]) {
		    			var continent = d["continent"];
		    			if (continent === "Africa") {
		    				return colorPicker("Africa");
		    			} else if (continent === "North America") {
		    				return colorPicker("North America");
		    			} else if (continent === "South America") {
		    				return colorPicker("South America");
		    			} else if (continent === "Europe") {
		    				return colorPicker("Europe");
		    			} else if (continent === "Asia") {
		    				return colorPicker("Asia");
		    			} else if (continent === "Australia") {
		    				return colorPicker("Australia");
		    			}
		    		} else if (d["country"]) {
		    			var parent = d.parent["continent"];
		    			if(parent === "Africa") {
		    				return AfricaColor(Math.floor(Math.random()*10));
		    			} else if(parent === "North America") {
		    				return NAmericaColor(Math.floor(Math.random()*10));
		    			} else if(parent === "South America") {
		    				return SAmericaColor(Math.floor(Math.random()*10));
		    			} else if(parent === "Europe") {
		    				return EuropeColor(Math.floor(Math.random()*10));
		    			} else if(parent === "Asia") {
		    				return AsiaColor(Math.floor(Math.random()*10));
		    			} else if(parent === "Australia") {
		    				return AustraliaColor(Math.floor(Math.random()*10));
		    			}
		    		}
		    	}
		    })
			.on("click", click)
	       	.each(stash);

	    //sets the current root to the current data
	    currentRoot = path.data;

	    //calculates the transition from old to new position of sunburst pieces
	    function arcTweenData(a, i) {
	    	var oi = d3.interpolate({x: a.x0, dx: a.dx0}, a);
	    	function tween(t) {
	    		var b = oi(t);
	    		a.x0 = b.x;
	    		a.dx0 = b.dx;
	    		return arc(b);
	    	}

	    	if (i == 0) {
	    		var xd = d3.interpolate(x.domain(), [node.x, node.x + node.dx]);
	    		return function(t) {
	    			x.domain(xd(t));
	    			return tween(t);
	    		};
	    	} else {
	    		return tween;
	    	} 
		}   
		//handles clicked data in sunburst
	    function click(d) {
	    	//makes it possible to click the already clicked level to go back to previous state
	    	if(d === currentRoot && d.parent) {
	    		currentRoot = d.parent;
	    		node = currentRoot;
	    	} else if (!d.children) {
	    		leafClick(d);
	    	}
	    	else {
	    		currentRoot = d;
	    		node = d;
	    		countryClick(d);
	    	}
	    	//makes the transition smooth (changing the levels)
	    	path.transition()
	    		.duration(1000)
	    		.attrTween("d", arcTweenData);
		}

	 });
	 
	 // Stash the old values for transition.
	 function stash(d) {
	   d.x0 = d.x;
	   d.dx0 = d.dx;
	 }

	 
</script>
<script src="info.js"></script>
</html>